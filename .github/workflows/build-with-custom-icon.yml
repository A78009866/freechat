name: Rebrand App (Icons & Name)

on:
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  customize-app:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙˆÙˆØ±ÙƒÙÙ„Ø§Ùˆ Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ±ÙØ¹Ù‡Ø§

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install ImageMagick
        run: |
          sudo apt-get update
          sudo apt-get install -y imagemagick

      - name: Update App Name and Icons
        run: |
          # --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ---
          ICON_SOURCE="custom-icon/myicon.png"
          RES_PATH="app/src/main/res"
          STRINGS_FILE="$RES_PATH/values/strings.xml"
          NEW_NAME="Aite"

          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©
          if [ ! -f "$ICON_SOURCE" ]; then
            echo "::error::Source icon not found at $ICON_SOURCE"
            exit 1
          fi

          # 1. ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ strings.xml
          echo "ğŸ“ Renaming app to $NEW_NAME..."
          sed -i "s/<string name=\"app_name\">.*<\/string>/<string name=\"app_name\">$NEW_NAME<\/string>/" "$STRINGS_FILE"

          # 2. Ø­Ø°Ù Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ…Ø§Ù…Ø§Ù‹
          echo "ğŸ—‘ï¸ Removing old icons..."
          # Ø­Ø°Ù Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª PNG Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          rm -f $RES_PATH/mipmap-*/ic_launcher.png
          rm -f $RES_PATH/mipmap-*/ic_launcher_round.png
          rm -f $RES_PATH/mipmap-*/ic_launcher_foreground.png
          
          # Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©: Ù†Ù‚ÙˆÙ… Ø¨Ø­Ø°Ù Ù…Ø¬Ù„Ø¯ anydpi Ù„Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ XML Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ØªÙƒÙŠÙØ©
          # Ø¥Ø°Ø§ Ù„Ù… Ù†Ø­Ø°ÙÙ‡ØŒ Ø³ÙŠØªØ¬Ø§Ù‡Ù„ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙŠØ³ØªØ®Ø¯Ù… XML Ø§Ù„Ù‚Ø¯ÙŠÙ…
          rm -rf $RES_PATH/mipmap-anydpi-v26

          # 3. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
          echo "ğŸ¨ Generating new icons..."
          
          # Ø­Ù„Ù‚Ø© ØªÙƒØ±Ø§Ø± Ù„Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© (Size:Folder)
          # mdpi=48, hdpi=72, xhdpi=96, xxhdpi=144, xxxhdpi=192
          for pair in "48:mipmap-mdpi" "72:mipmap-hdpi" "96:mipmap-xhdpi" "144:mipmap-xxhdpi" "192:mipmap-xxxhdpi"; do
            # ÙØµÙ„ Ø§Ù„Ø­Ø¬Ù… Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯
            IFS=":" read -r size folder <<< "$pair"
            
            # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø¬Ù„Ø¯
            mkdir -p "$RES_PATH/$folder"
            
            echo "   -> Generating $size px for $folder"

            # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø±Ø¨Ø¹Ø©
            convert "$ICON_SOURCE" -resize ${size}x${size} "$RES_PATH/$folder/ic_launcher.png"

            # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© (Ù‚Øµ Ø¯Ø§Ø¦Ø±ÙŠ)
            convert "$ICON_SOURCE" -resize ${size}x${size} \
              \( +clone -alpha extract -draw "fill black polygon 0,0 0,$size $size,0 fill white circle $(($size/2)),$(($size/2)) $(($size/2)),0" \) \
              -alpha off -compose CopyOpacity -composite \
              "$RES_PATH/$folder/ic_launcher_round.png"
          done

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
          git add app/src/main/res/mipmap-*
          git add app/src/main/res/values/strings.xml
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Rebrand: Set app name to Aite and updated icons"
            git push
          fi
